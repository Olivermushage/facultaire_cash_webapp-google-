{% extends "base.html" %}

{% block title %}Historique des op√©rations{% endblock %}

{% block content %}
<h1>üìú Historique des op√©rations</h1>

<!-- Formulaire de recherche -->
<form method="get" class="form-inline mb-20">
    <input type="text" name="recherche" value="{{ request.args.get('recherche', '') }}"
           placeholder="üîé Rechercher..." class="input-search">
    <button type="submit" class="btn-primary">Filtrer</button>
    {% if request.args.get('recherche') %}
        <a href="{{ url_for('historique') }}" class="btn-link">‚ùå R√©initialiser</a>
    {% endif %}
</form>

<!-- Section op√©rations en caisse -->
<section class="mb-40">
<h2>üí∞ Op√©rations en caisse</h2>
<div class="table-scroll">
    <table class="table-default">
        <thead>
            <tr>
                <th>Date & heure</th>
                <th>Utilisateur</th>
                <th>Nom</th>
                <th>Type</th>
                <th>Montant (USD)</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            {% for op in operations %}
            <tr>
                <td>{{ op.date_heure or op.Date or '-' }}</td>
                <td>{{ op.utilisateur or 'Inconnu' }}</td>
                <td>{{ op.Nom or '-' }}</td>
                <td>{{ op.Type or '-' }}</td>
                <td>{{ "%.2f"|format(op.Montant) if op.Montant else "0.00" }}</td>
                <td>{{ op.Description or '-' }}</td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="text-center">Aucune op√©ration enregistr√©e.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</section>

<!-- Pagination -->
<div class="pagination mb-40">
    {% if page > 1 %}
        <a href="{{ url_for('historique', page=page-1, recherche=request.args.get('recherche','')) }}">&laquo; Pr√©c√©dent</a>
    {% else %}
        <span class="disabled">&laquo; Pr√©c√©dent</span>
    {% endif %}
    <span>Page {{ page }} sur {{ total_pages }}</span>
    {% if page < total_pages %}
        <a href="{{ url_for('historique', page=page+1, recherche=request.args.get('recherche','')) }}">Suivant &raquo;</a>
    {% else %}
        <span class="disabled">Suivant &raquo;</span>
    {% endif %}
</div>

<!-- D√©penses classiques -->
<section class="mb-40">
<h2>üìä D√©penses classiques</h2>
<div class="table-scroll">
    <table class="table-default">
        <thead>
            <tr>
                <th>Nom Classe</th>
                <th>Date</th>
                <th>Cat√©gorie</th>
                <th>Description</th>
                <th>Montant (USD)</th>
            </tr>
        </thead>
        <tbody>
            {% for dep in depenses_classiques %}
            <tr>
                <td>{{ dep.NomClasse or '-' }}</td>
                <td>{{ dep.DateExamen or dep.DateDepense or '-' }}</td>
                <td>{{ dep.CategorieDepense or '-' }}</td>
                <td>{{ dep.Description or dep.Commentaire or '-' }}</td>
                <td>{{ "%.2f"|format(dep.Montant) if dep.Montant else "0.00" }}</td>
            </tr>
            {% else %}
            <tr><td colspan="5" class="text-center">Aucune d√©pense classique enregistr√©e.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</section>

<!-- D√©penses travaux -->
<section class="mb-40">
<h2>üõ†Ô∏è D√©penses li√©es aux travaux</h2>
<div class="table-scroll">
    <table class="table-default">
        <thead>
            <tr>
                <th>Nom Classe</th>
                <th>√âtudiant</th>
                <th>Cat√©gorie Travail</th>
                <th>Type D√©pense</th>
                <th>Commentaire</th>
                <th>Date</th>
                <th>Montant (USD)</th>
            </tr>
        </thead>
        <tbody>
            {% for dep in depenses_travaux %}
            <tr>
                <td>{{ dep.NomClasse or '-' }}</td>
                <td>{{ dep.Etudiant or '-' }}</td>
                <td>{{ dep.CategorieDepense or dep.CategorieTravail or '-' }}</td>
                <td>{{ dep.TypeDepense or '-' }}</td>
                <td>{{ dep.Commentaire or '-' }}</td>
                <td>{{ dep.DateDepense or '-' }}</td>
                <td>{{ "%.2f"|format(dep.Montant) if dep.Montant else "0.00" }}</td>
            </tr>
            {% else %}
            <tr><td colspan="7" class="text-center">Aucune d√©pense li√©e aux travaux enregistr√©e.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</section>

<!-- Recettes -->
<section class="mb-40">
<h2>üìà Recettes</h2>
<div class="table-scroll">
    <table class="table-default">
        <thead>
            <tr>
                <th>Date</th>
                <th>Source</th>
                <th>Type</th>
                <th>Description</th>
                <th>Montant (USD)</th>
            </tr>
        </thead>
        <tbody>
            {% for rec in recettes %}
            <tr>
                <td>{{ rec.Date or '-' }}</td>
                <td>{{ rec.Source or '-' }}</td>
                <td>{{ rec.Type or '-' }}</td>
                <td>{{ rec.Description or '-' }}</td>
                <td>{{ "%.2f"|format(rec.Montant) if rec.Montant else "0.00" }}</td>
            </tr>
            {% else %}
            <tr><td colspan="5" class="text-center">Aucune recette enregistr√©e.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</section>

<p class="mt-40">
  <a href="{{ url_for('main.index') }}" class="btn-link">‚¨Ö Retour √† l'accueil</a>
</p>
{% endblock %}
