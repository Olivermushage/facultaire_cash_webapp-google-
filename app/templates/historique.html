{% extends "base.html" %}

{% block title %}Historique des opÃ©rations{% endblock %}

{% block content %}
<h1 class="mb-20">ğŸ“œ Historique des opÃ©rations</h1>

<!-- ğŸ” Barre de recherche -->
<form method="get" class="form-inline mb-20">
  <input type="text" name="recherche" value="{{ request.args.get('recherche', '') }}"
         placeholder="Rechercher..." class="input-search">
  <button type="submit" class="btn-primary">Filtrer</button>
  {% if request.args.get('recherche') %}
    <a href="{{ url_for('main.historique') }}" class="btn-link">âŒ RÃ©initialiser</a>
  {% endif %}
</form>

<!-- ğŸ’° OpÃ©rations en caisse -->
<section class="mb-40">
  <h2>ğŸ’° OpÃ©rations en caisse</h2>
  <div class="table-scroll">
    <table class="table-default">
      <thead>
        <tr>
          <th style="width:130px;">Date & Heure</th>
          <th style="width:120px;">Utilisateur</th>
          <th style="width:150px;">Nom</th>
          <th style="width:100px;">Type</th>
          <th style="width:120px;" class="text-right">Montant (USD)</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        {% for op in operations %}
        <tr>
          <td>{{ op.date_heure or op.Date or '-' }}</td>
          <td>{{ op.utilisateur|default('Inconnu') }}</td>
          <td>{{ op.Nom|default('-') }}</td>
          <td>{{ op.Type|default('-') }}</td>
          <td class="text-right">{{ "%.2f"|format(op.Montant or 0) }}</td>
          <td>{{ op.Description|default('-') }}</td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="text-center">Aucune opÃ©ration enregistrÃ©e.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<!-- ğŸ“„ Pagination -->
<div class="pagination mb-40">
  {% if page > 1 %}
    <a href="{{ url_for('main.historique', page=page-1, recherche=request.args.get('recherche','')) }}" class="btn-page">&laquo; PrÃ©cÃ©dent</a>
  {% else %}
    <span class="btn-page disabled">&laquo; PrÃ©cÃ©dent</span>
  {% endif %}

  <span class="mx-10">Page {{ page }} / {{ total_pages }}</span>

  {% if page < total_pages %}
    <a href="{{ url_for('main.historique', page=page+1, recherche=request.args.get('recherche','')) }}" class="btn-page">Suivant &raquo;</a>
  {% else %}
    <span class="btn-page disabled">Suivant &raquo;</span>
  {% endif %}
</div>

<!-- ğŸ“Š DÃ©penses classiques -->
<section class="mb-40">
  <h2>ğŸ“Š DÃ©penses classiques</h2>
  <div class="table-scroll">
    <table class="table-default">
      <thead>
        <tr>
          <th>Classe</th>
          <th>Date</th>
          <th>CatÃ©gorie</th>
          <th>Description</th>
          <th class="text-right">Montant (USD)</th>
        </tr>
      </thead>
      <tbody>
        {% for dep in depenses_classiques %}
        <tr>
          <td>{{ dep.NomClasse|default('-') }}</td>
          <td>{{ dep.DateExamen or dep.DateDepense or '-' }}</td>
          <td>{{ dep.CategorieDepense|default('-') }}</td>
          <td>{{ dep.Description or dep.Commentaire or '-' }}</td>
          <td class="text-right">{{ "%.2f"|format(dep.Montant or 0) }}</td>
        </tr>
        {% else %}
        <tr><td colspan="5" class="text-center">Aucune dÃ©pense classique enregistrÃ©e.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<!-- ğŸ› ï¸ DÃ©penses travaux -->
<section class="mb-40">
  <h2>ğŸ› ï¸ DÃ©penses liÃ©es aux travaux</h2>
  <div class="table-scroll">
    <table class="table-default">
      <thead>
        <tr>
          <th>Classe</th>
          <th>Ã‰tudiant</th>
          <th>CatÃ©gorie</th>
          <th>Type</th>
          <th>Commentaire</th>
          <th>Date</th>
          <th class="text-right">Montant (USD)</th>
        </tr>
      </thead>
      <tbody>
        {% for dep in depenses_travaux %}
        <tr>
          <td>{{ dep.NomClasse|default('-') }}</td>
          <td>{{ dep.Etudiant|default('-') }}</td>
          <td>{{ dep.CategorieDepense or dep.CategorieTravail or '-' }}</td>
          <td>{{ dep.TypeDepense|default('-') }}</td>
          <td>{{ dep.Commentaire|default('-') }}</td>
          <td>{{ dep.DateDepense|default('-') }}</td>
          <td class="text-right">{{ "%.2f"|format(dep.Montant or 0) }}</td>
        </tr>
        {% else %}
        <tr><td colspan="7" class="text-center">Aucune dÃ©pense liÃ©e aux travaux enregistrÃ©e.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<!-- ğŸ“ˆ Recettes -->
<section class="mb-40">
  <h2>ğŸ“ˆ Recettes</h2>
  <div class="table-scroll">
    <table class="table-default">
      <thead>
        <tr>
          <th>Date</th>
          <th>Source</th>
          <th>Type</th>
          <th>Description</th>
          <th class="text-right">Montant (USD)</th>
        </tr>
      </thead>
      <tbody>
        {% for rec in recettes %}
        <tr>
          <td>{{ rec.Date|default('-') }}</td>
          <td>{{ rec.Source|default('-') }}</td>
          <td>{{ rec.Type|default('-') }}</td>
          <td>{{ rec.Description|default('-') }}</td>
          <td class="text-right">{{ "%.2f"|format(rec.Montant or 0) }}</td>
        </tr>
        {% else %}
        <tr><td colspan="5" class="text-center">Aucune recette enregistrÃ©e.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<!-- ğŸ“‹ Inscriptions -->
<section class="mb-40">
  <h2>ğŸ“‹ Inscriptions</h2>
  <table class="table-default">
    <thead>
      <tr>
        <th>Classe</th>
        <th>Ã‰tudiant</th>
        <th>Type</th>
        <th>Statut</th>
        <th class="text-right">Montant</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      {% for ins in inscriptions %}
      <tr>
        <td>{{ ins.NomClasse }}</td>
        <td>{{ ins.Etudiant }}</td>
        <td>{{ ins.TypeInscription }}</td>
        <td>{{ ins.StatutPaiement }}</td>
        <td class="text-right">{{ ins.Montant }}</td>
        <td>{{ ins.DatePaiement }}</td>
      </tr>
      {% else %}
      <tr><td colspan="6" class="text-center">Aucune inscription enregistrÃ©e.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>

<!-- ğŸ“š Paiements travaux -->
<section class="mb-40">
  <h2>ğŸ“š Paiements Travaux</h2>
  <table class="table-default">
    <thead>
      <tr>
        <th>Classe</th>
        <th>Ã‰tudiant</th>
        <th>Type</th>
        <th>Statut</th>
        <th class="text-right">Montant</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      {% for p in paiements_travaux %}
      <tr>
        <td>{{ p.NomClasse }}</td>
        <td>{{ p.Etudiant }}</td>
        <td>{{ p.TypeTravail }}</td>
        <td>{{ p.StatutPaiement }}</td>
        <td class="text-right">{{ p.Montant }}</td>
        <td>{{ p.DatePaiement }}</td>
      </tr>
      {% else %}
      <tr><td colspan="6" class="text-center">Aucun paiement travaux enregistrÃ©.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>

<!-- ğŸ”™ Retour -->
<p class="mt-40">
  <a href="{{ url_for('main.index') }}" class="btn-link">â¬… Retour Ã  l'accueil</a>
</p>
{% endblock %}
