{% extends "base.html" %}

{% block title %}Ajouter une dépense liée à un examen{% endblock %}

{% block content %}
<h2>Ajouter une dépense liée à un examen</h2>

{# Messages flash #}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-container">
      {% for category, message in messages %}
        <div class="flash-message
            {% if category == 'success' %}flash-success{% endif %}
            {% if category == 'error' %}flash-error{% endif %}
            {% if category == 'warning' %}flash-warning{% endif %}
            {% if category == 'info' %}flash-info{% endif %}">
          {{ message }}
          <button class="flash-close-btn" onclick="this.parentElement.style.display='none';">×</button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<form method="post" class="form-default" style="max-width: 600px; margin-top: 20px;">
    <label for="nom_cours" class="label-default">Cours <span class="text-danger">*</span></label>
    <input type="text" id="nom_cours" name="nom_cours" required
           value="{{ request.form.get('nom_cours', '') }}" class="input-default">

    <label for="date_examen" class="label-default">Date examen <span class="text-danger">*</span></label>
    <input type="date" id="date_examen" name="date_examen" required
           value="{{ request.form.get('date_examen', '') }}" class="input-default">

    <label for="categorie" class="label-default">Catégorie dépense <span class="text-danger">*</span></label>
    <select id="categorie" name="categorie" required class="input-default">
        <option value="" disabled {% if not request.form.get('categorie') %}selected{% endif %}>-- Sélectionnez une catégorie --</option>
        {% for cat in categories %}
            <option value="{{ cat }}" {% if cat == request.form.get('categorie') %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
    </select>

    <div id="categorie-autre-div" style="{% if request.form.get('categorie') != 'Autre' %}display:none;{% endif %}">
        <label for="categorie_autre" class="label-default">Précisez la catégorie (si "Autre") <span class="text-danger">*</span></label>
        <input type="text" id="categorie_autre" name="categorie_autre"
               value="{{ request.form.get('categorie_autre', '') }}" class="input-default">
    </div>

    <label for="description" class="label-default">Description</label>
    <input type="text" id="description" name="description"
           value="{{ request.form.get('description', '') }}" class="input-default">

    <label for="montant" class="label-default">Montant (USD) <span class="text-danger">*</span></label>
    <input type="number" step="0.01" min="0.01" id="montant" name="montant" required
           value="{{ request.form.get('montant', '') }}" class="input-default">

    <div class="form-actions">
        <a href="{{ url_for('main.index') }}" class="btn-link">← Retour à l'accueil</a>
        <button type="submit" class="btn-success">Enregistrer</button>
    </div>

    <div class="form-note">
        <span class="text-danger">*</span> Champs obligatoires
    </div>
</form>

<script>
function toggleCategorieAutre() {
    const select = document.getElementById("categorie");
    const autreDiv = document.getElementById("categorie-autre-div");
    const inputAutre = document.getElementById("categorie_autre");

    if (select.value === "Autre") {
        autreDiv.style.display = "block";
        inputAutre.setAttribute("required", "required");
    } else {
        autreDiv.style.display = "none";
        inputAutre.removeAttribute("required");
        inputAutre.value = "";
    }
}

document.addEventListener('DOMContentLoaded', function() {
    toggleCategorieAutre();
    document.getElementById("categorie").addEventListener("change", toggleCategorieAutre);
});
</script>
{% endblock %}
