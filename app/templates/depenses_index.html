{% extends "base.html" %}

{% block title %}{{ titre }}{% endblock %}

{% block content %}
<h1>{{ titre }}</h1>

<!-- Messages flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-container" style="max-width:700px; margin-bottom:20px;">
      {% for category, message in messages %}
        <div class="flash-message flash-{{ category }}" role="alert"
             style="padding:10px; border-radius:4px; margin-bottom:8px; position:relative;">
          {{ message }}
          <button type="button" aria-label="Fermer le message" onclick="this.parentElement.style.display='none';"
                  style="position:absolute; top:4px; right:8px; background:none; border:none; font-weight:bold; cursor:pointer; color:inherit;">
            &times;
          </button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Formulaire de recherche -->
<form method="get" class="form-inline" style="margin-bottom:20px; max-width:700px; display:flex; gap:8px;">
    <input type="search" name="recherche" value="{{ request.args.get('recherche', '') }}"
           placeholder="Rechercher par description, catégorie ou utilisateur..." class="input-default" style="flex-grow:1;">
    <button type="submit" class="btn-primary" style="padding:6px 16px;">Filtrer</button>
    {% if request.args.get('recherche') %}
        <a href="{{ url_for(request.endpoint) }}" class="link-default" style="align-self:center;">Réinitialiser</a>
    {% endif %}
</form>

<!-- Tableau des dépenses -->
<section class="table-section table-scroll" style="max-width:900px; overflow-x:auto;">
<table class="table-default">
    <thead>
    <tr>
        <th>Nom Cours</th>
        <th>Catégorie Dépense</th>
        <th>Description</th>
        <th>Montant (USD)</th>
        <th>Nom Classe</th>
        <th>Type Dépense</th>
        <th>Commentaire</th>
        <th>Date Dépense</th>
    </tr>
</thead>
<tbody>
    {% for depense in depenses %}
    <tr>
        <td>{{ depense.NomCours or '-' }}</td>
        <td>{{ depense.CategorieDepense or '-' }}</td>
        <td>{{ depense.Description or '-' }}</td>
        <td>{{ "%.2f"|format(depense.Montant|float) }} USD</td>
        <td>{{ depense.NomClasse or '-' }}</td>
        <td>{{ depense.TypeDepense or '-' }}</td>
        <td>{{ depense.Commentaire or '-' }}</td>
        <td>{{ depense.DateDepense or '-' }}</td>
    </tr>
    {% else %}
    <tr>
        <td colspan="8" class="text-center">Aucune dépense enregistrée.</td>
    </tr>
    {% endfor %}
</tbody>

</table>
</section>

<!-- Pagination -->
<div class="pagination" style="margin-top:15px; display:flex; gap:10px; align-items:center;">
    {% if page > 1 %}
        <a href="{{ url_for(request.endpoint, page=page-1, recherche=request.args.get('recherche','')) }}" class="link-default">&laquo; Précédent</a>
    {% else %}
        <span class="disabled">&laquo; Précédent</span>
    {% endif %}
    <span>Page {{ page }} sur {{ total_pages }}</span>
    {% if page < total_pages %}
        <a href="{{ url_for(request.endpoint, page=page+1, recherche=request.args.get('recherche','')) }}" class="link-default">Suivant &raquo;</a>
    {% else %}
        <span class="disabled">Suivant &raquo;</span>
    {% endif %}
</div>

<!-- Lien retour -->
<p style="margin-top:20px;">
    <a href="{{ url_for('main.index') }}" class="link-default">&larr; Retour à l'accueil</a>
</p>
{% endblock %}
