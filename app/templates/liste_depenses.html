<!-- templates/liste_depenses.html -->
{% extends "base.html" %}

{% block title %}{{ titre }}{% endblock %}

{% block content %}
<h1>{{ titre }}</h1>

<!-- Messages flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-container">
      {% for category, message in messages %}
        <div class="flash-message flash-{{ category }}">
          {{ message }}
          <button type="button" onclick="this.parentElement.style.display='none';">&times;</button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Recherche -->
<form method="get" class="form-inline" style="margin-bottom:20px; max-width:700px;">
    <input type="search" name="recherche" value="{{ request.args.get('recherche', '') }}"
           placeholder="Rechercher par description ou cat√©gorie..."
           class="input-default" style="flex-grow:1;">
    <button type="submit" class="btn-primary">üîç Filtrer</button>
    {% if request.args.get('recherche') %}
        <a href="{{ url_for(request.endpoint, nom_classe=nom_classe) }}" class="link-default">‚Ü© R√©initialiser</a>
    {% endif %}
</form>

<!-- Tableau des d√©penses -->
<section class="table-section table-scroll">
  <table class="table-default">
    <thead>
      <tr>
        <th>Cours</th>
        <th>Date Examen</th>
        <th>Cat√©gorie</th>
        <th>Description</th>
        <th>Utilisateur</th>
        <th style="text-align:right;">Montant (USD)</th>
        <th style="text-align:center;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for depense in depenses %}
      <tr>
        <td>{{ depense.NomCours or '-' }}</td>
        <td>{{ depense.DateExamen or '-' }}</td>
        <td>{{ depense.CategorieDepense }}</td>
        <td>{{ depense.Description or '-' }}</td>
        <td>{{ depense.utilisateur or '-' }}</td>
        <td style="text-align:right;">{{ "%.2f"|format(depense.Montant) }} USD</td>
        <td style="text-align:center;">
          {% if depense.ID %}
            <a href="{{ url_for('depenses.modifier_depense', depense_id=depense.ID) }}" class="link-default">‚úèÔ∏è Modifier</a>
          {% else %}
            <span class="text-muted">ID manquant</span>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr><td colspan="7" class="text-center">Aucune d√©pense enregistr√©e.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>

<!-- Pagination -->
<div class="pagination">
    {% if page > 1 %}
        <a href="{{ url_for(request.endpoint, page=page-1, recherche=request.args.get('recherche',''), nom_classe=nom_classe) }}" class="link-default">&laquo; Pr√©c√©dent</a>
    {% else %}
        <span class="disabled">&laquo; Pr√©c√©dent</span>
    {% endif %}

    <span>Page {{ page }} sur {{ total_pages }}</span>

    {% if page < total_pages %}
        <a href="{{ url_for(request.endpoint, page=page+1, recherche=request.args.get('recherche',''), nom_classe=nom_classe) }}" class="link-default">Suivant &raquo;</a>
    {% else %}
        <span class="disabled">Suivant &raquo;</span>
    {% endif %}
</div>

<p>
  <a href="{{ url_for('depenses.depenses_index') }}" class="btn-secondary">‚Üê Retour aux d√©penses</a>
</p>
{% endblock %}
